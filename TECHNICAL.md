# HamLogHelper 技术性配置文档

## 0. 免责声明

本软件一开始是作为作者自用的项目所开发的, 所以 **请您对自己的输入 / 操作负责** , 造成的数据丢失或其他损失 **作者概不负责** , 请您谅解.

## 1. 编译

本项目为混合型语言编程, 前端使用纯 html/js/css , 后端使用 golang . 您可以直接运行 `go build` 来编译二进制文件. 前端所用的静态资源文件将被自动打包 (go embed).

## 2. 启动参数

可执行文件有两个启动参数, 可以通过 `-help` 调出:

1. `-a` 指定绑定的地址, 默认 `127.0.0.1:5973` , 可自行修改, 如 `-a 0.0.0.0:1234` 或 `-a :7359`.
   + **警告: 您不应将服务暴露在公网下! 注意本程序无多用户隔离、输入验证和安全防护! 允许自定绑定端口只是为了使用方便!**
2. `-s` 指定静默启动, 若无此参数将尝试使用系统默认配置项打开前端页面的网址 (即自动调起浏览器)

若有需要, 可以另建脚本文件进行调用执行.

## 3. 检查更新

软件启动时打开一个协程进行更新检查, 完毕后自行退出. 更新检查使用 `Github API` 获取仓库最新发行版. 检测到新版本或出错将进行控制台输出, 检查到已为最新版则不输出.

## 4. 日志文件

日志文件后缀为 `.hjl` , 意为 `Ham JSON Logline` , 其原理类似日志型数据库. 每一行为一个 JSON 字符串, 按照 `index` 字段排序. 当打本软件开这个文件时, 内容将被读取并整理, 此时同 `index` 的行后写入的将覆盖前面存在的, 而负的 `index` 标志着 `index` 为其绝对值的项将被删除. 整理过程中若遇到删除, 后面的 `index` 将自动向前补位, 保持序号的连贯性.

在整理过程中, 后端所使用的数据结构是 **单向链表** . 整理结束后将被释放. 前端回传的信息将一行行直接写入文件, 防止意外导致的存储丢失.

后端 golang 中 `Rst` 保存的类型是 `any`, 这是为了向下兼容. `v1.5.0` 版本中前端返回的结果中 `rst` 的类型由 `number` 变成了 `string`.

## 5. 前端打开的文件

前端打开文件之后将使用 `localStorage` 存储文件名, 这样当页面刷新后不会展示输入提示框就能直接读取文件.

"打开新文件" 的原理是清除存储的值后刷新页面.

## 6. 输入快捷键

`Ctrl+<数字>` 或 `Meta+<数字>` 可以快速选定右侧的输入建议. 一般来说, 这两个快捷键不会被占用. 若您发现快捷键冲突, 请检查电脑上的其他工具是否占用这些快捷键. (作者遇到过 *PowerToys* 里面工具占用快捷键的, 一按 `Ctrl+1` 就放大画面)

## 7. 自定义模板

json格式, 须命名为 `tmpl.json` 且和可执行文件在同一目录下才可被加载. 示例:

```json
[
    {
        "callsign": "BG4QBF",
        "rig": "宝锋5RH",
        "ant": "老鹰770拉杆",
        "pwr": "高",
        "qth": "江苏镇江京口区"
    },
    {
        "callsign": "BG4QBF",
        "rig": "泉盛UV-K6",
        "ant": "原装",
        "pwr": "5W",
        "qth": "江苏南京紫金山头陀岭"
    }
]
```

## 8. 自定义字典

json格式, 须命名为 `dict.json` 且和可执行文件在同一目录下才可被加载. 示例:

```json
{
    "rig":{
        "bf": [
            "宝锋5RH",
            "宝锋UV5R",
            "宝锋UV5RMini",
            "宝锋UV32"
        ],
        "b5r": [
            "宝锋5RH",
            "宝锋UV5R",
            "宝锋UV5RMini"
        ],
        "b32": [
            "宝锋UV32"
        ]
    },
    "ant":{
        "2e": [
            "2单元八木"
        ],
        "3e": [
            "3单元八木",
            "3单元CJU"
        ]
    },
    "pwr":{
        "h": [
            "高"
        ],
        "m": [
            "中",
            "满"
        ],
        "max": [
            "满"
        ],
        "l": [
            "低"
        ]
    },
    "qth":{
        "xlw": [
            "江苏南京孝林卫"
        ],
        "yfq": [
            "江苏南京油坊桥"
        ],
        "yht": [
            "江苏南京雨花台"
        ],
        "cpu": [
            "江苏南京中国药科大学"
        ]
    }
}
```

## 9. 数据导出

1. 简单的 ADIF 文件
   + 仅包含如下字段
     1. CALL
     2. BAND
     3. MODE
     4. QSO_DATE
     5. TIME_ON
     6. FREQ
     7. BAND_RX
     8. FREQ_RX
2. 标准 CSV 文件 (使用 `golang: encoding/csv` 库)
   + 可以自选要导出哪些信息以及其顺序
     1. 位号 - index
     2. 呼号 - callsign
     3. 时间 - dt
     4. 频率 - band
     5. 模式 - mode
     6. 信号 - rst
     7. 对方设备 - rrig
     8. 对方天线 - rant
     9. 对方功率 - rpwr
     10. 对方台址 - rqth
     11. 己方设备 - trig
     12. 己方天线 - tant
     13. 己方功率 - tpwr
     14. 己方台址 - tqth
     15. 备注 - rmks
3. Excel 表格文件 (使用 `golang: github.com/xuri/excelize/v2` 库)
   + 可以自选要导出哪些信息以及其顺序
     1. 位号 - index
     2. 呼号 - callsign
     3. 时间 - dt
     4. 频率 - band
     5. 模式 - mode
     6. 信号 - rst
     7. 对方设备 - rrig
     8. 对方天线 - rant
     9. 对方功率 - rpwr
     10. 对方台址 - rqth
     11. 己方设备 - trig
     12. 己方天线 - tant
     13. 己方功率 - tpwr
     14. 己方台址 - tqth
     15. 备注 - rmks

## 10. 一部分答疑

1. Q: 为什么后端选择了 golang
   + A: 纯前端 js 也行, 当时定下的技术路线现在懒得改了
2. Q: 丑
   + 丑就对了, css 跟几乎没写一样, 哈哈
3. Q: 难用
   + A: 做软件的初衷是自用, 作者即第一用户, 很多我觉得舒服的功能您不一定能适应. 您可以选择其他的更完善的产品
4. Q: 要录音识别 / 接入 AI 自动识别
   + A: 其实这个项目立项就是因为看到别的友台的 AI 记录软件, 觉得应该不需要 AI 也行, 这才有了 "模板 & 字典补全".
5. Q: XXX 功能怎么用 / 我觉得你 XXX 地方有问题
   + 自认为说明书写的完备, AI 读说明书而自己不读的建议先读一遍. 功能上或逻辑上有问题非常非常非常欢迎您提出! 我会尽力优化 (不优化的点也会给出理由)
6. Q: "关于 AI，目标应该放在做一个好用的记录软件，而不是证明自己编程过程有多么政治正确，没被 AI 玷污过，用户根本不关心那个，只要高效解决问题，AIGC 不丢人。"
   + 压根没往这方面想过. 编程不用 AI 只是我的个人习惯. 我可以面向搜索引擎高效解决问题, 当然搜索引擎也会有 AIGC 的内容, 我并不觉得 AIGC 丢人. 没有闲钱买 token 你又不给我钱，对生成内容不太信任每次自己纠错半天, 什么时候用什么时候不用以及如何使用就是我的自由了.
   + 我倒是承认我或许有 "赛博洁癖", 下载东西全是受信源, 好处是没中过毒, 坏处是找资源找半天.
