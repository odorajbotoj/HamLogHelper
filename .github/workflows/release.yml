name: Release

on:
  release:
    types:
      - published

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5
      - name: Setup Go
        uses: actions/setup-go@v6
        with:
          go-version: '>=1.25.5'
      - name: Install dependencies
        run: go get .
      - run: mkdir build
      - name: Build linux/386
        run: CGO_ENABLED=0 GOOS=linux GOARCH=386 go build -ldflags "-s -w" -o build/HamLogHelper-linux_386
      - name: Build linux/amd64
        run: CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags "-s -w" -o build/HamLogHelper-linux_amd64
      - name: Build linux/arm
        run: CGO_ENABLED=0 GOOS=linux GOARCH=arm go build -ldflags "-s -w" -o build/HamLogHelper-linux_arm
      - name: Build linux/arm64
        run: CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -ldflags "-s -w" -o build/HamLogHelper-linux_arm64
      - name: Build linux/riscv64
        run: CGO_ENABLED=0 GOOS=linux GOARCH=riscv64 go build -ldflags "-s -w" -o build/HamLogHelper-linux_riscv64
      - name: Build windows/386
        run: CGO_ENABLED=0 GOOS=windows GOARCH=386 go build -ldflags "-s -w" -o build/HamLogHelper-windows_386.exe
      - name: Build windows/amd64
        run: CGO_ENABLED=0 GOOS=windows GOARCH=amd64 go build -ldflags "-s -w" -o build/HamLogHelper-windows_amd64.exe
      - name: Build windows/arm
        run: CGO_ENABLED=0 GOOS=windows GOARCH=arm go build -ldflags "-s -w" -o build/HamLogHelper-windows_arm.exe
      - name: Build windows/arm64
        run: CGO_ENABLED=0 GOOS=windows GOARCH=arm64 go build -ldflags "-s -w" -o build/HamLogHelper-windows_arm64.exe
      - name: Build darwin/amd64
        run: CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -ldflags "-s -w" -o build/HamLogHelper-darwin_amd64
      - name: Build darwin/arm64
        run: CGO_ENABLED=0 GOOS=darwin GOARCH=arm64 go build -ldflags "-s -w" -o build/HamLogHelper-darwin_arm64
      - name: Upload
        uses: actions/upload-artifact@v4
        with:
          name: auto-builds
          path: build/

  upload-to-release:
    needs:
      - build
    permissions:
      contents: write
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v5
      - uses: actions/download-artifact@v4
        with:
          name: auto-builds
          path: build/
      - name: Upload
        uses: softprops/action-gh-release@v2
        with:
          files: |
            build/HamLogHelper-linux_386
            build/HamLogHelper-linux_amd64
            build/HamLogHelper-linux_arm
            build/HamLogHelper-linux_arm64
            build/HamLogHelper-linux_riscv64
            build/HamLogHelper-windows_386.exe
            build/HamLogHelper-windows_amd64.exe
            build/HamLogHelper-windows_arm.exe
            build/HamLogHelper-windows_arm64.exe
            build/HamLogHelper-darwin_amd64
            build/HamLogHelper-darwin_arm64
