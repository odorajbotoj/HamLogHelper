<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <title>ç¼–è¾‘æ•°æ®åº“ - ä¸šä½™æ— çº¿ç”µå°ç½‘ç‚¹åè®°å½•åŠ©æ‰‹ - BG4QBF</title>
    <script type="text/javascript" defer>
        // æ•°æ®
        var tmpljson, dictjson;

        // ä¼ªé€‰é¡¹å¡
        function show(id) {
            document.querySelectorAll(".edit").forEach(e => e.hidden = true);
            document.getElementById(id).hidden = false;
        }

        // è·å–æ•°æ®
        fetch(`http://${window.location.host}/tmpl.json`)
            .then((response) => {
                if (response.ok) return response.json();
                else return null;
            })
            .then((data) => {
                if (data) {
                    tmpljson = data;
                    let tmpltb = document.getElementById("tmpltable");
                    for (let i of tmpljson) {
                        let tr = document.createElement("tr");
                        tr.innerHTML = `<td><input type="button" value="ğŸ—‘ï¸" onclick="this.parentNode.parentNode.remove();"><input type="button" value="â¬†ï¸" onclick="if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);"><input type="button" value="â¬‡ï¸" onclick="if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);"></td><td><input type="text" class="tmpl_callsign" value="${i.callsign}"></td><td><input type="text" class="tmpl_rig" value="${i.rig}"></td><td><input type="text" class="tmpl_ant" value="${i.ant}"></td><td><input type="text" class="tmpl_pwr" value="${i.pwr}"></td><td><input type="text" class="tmpl_qth" value="${i.qth}"></td>`;
                        tmpltb.appendChild(tr);
                    }
                }
            });
        fetch(`http://${window.location.host}/dict.json`)
            .then((response) => {
                if (response.ok) return response.json();
                else return null;
            })
            .then((data) => {
                dictjson = data;
                // ç”Ÿæˆè¡¨æ ¼ dict
                let dicttb_rig = document.getElementById("dicttable_rig");
                for (let i of Object.keys(dictjson.rig)) {
                    let tr = document.createElement("tr");
                    let inh = `<td><input type="button" value="ğŸ—‘ï¸" onclick="this.parentNode.parentNode.remove();"><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type="button" value="æ–°å»ºå€¼" onclick="this.parentNode.parentNode.querySelector('.dict_values').insertAdjacentHTML('beforeend', '<div><input type=\\'text\\' class=\\'dict_td_input\\' onblur=\\'if (!this.value) this.parentNode.remove();\\'></div>');"></td><td><input type="text" class="dict_key" value="${i}"></td><td class="dict_values">`;
                    for (let j of dictjson.rig[i]) {
                        inh += `<div><input type="text" class="dict_td_input" value="${j}" onblur="if (!this.value) this.parentNode.remove();"></div>`;
                    }
                    tr.innerHTML = inh + "</td>";
                    dicttb_rig.appendChild(tr);
                }
                let dicttb_ant = document.getElementById("dicttable_ant");
                for (let i of Object.keys(dictjson.ant)) {
                    let tr = document.createElement("tr");
                    let inh = `<td><input type="button" value="ğŸ—‘ï¸" onclick="this.parentNode.parentNode.remove();"><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type="button" value="æ–°å»ºå€¼" onclick="this.parentNode.parentNode.querySelector('.dict_values').insertAdjacentHTML('beforeend', '<div><input type=\\'text\\' class=\\'dict_td_input\\' onblur=\\'if (!this.value) this.parentNode.remove();\\'></div>');"></td><td><input type="text" class="dict_key" value="${i}"></td><td class="dict_values">`;
                    for (let j of dictjson.ant[i]) {
                        inh += `<div><input type="text" class="dict_td_input" value="${j}" onblur="if (!this.value) this.parentNode.remove();"></div>`;
                    }
                    tr.innerHTML = inh + "</td>";
                    dicttb_ant.appendChild(tr);
                }
                let dicttb_pwr = document.getElementById("dicttable_pwr");
                for (let i of Object.keys(dictjson.pwr)) {
                    let tr = document.createElement("tr");
                    let inh = `<td><input type="button" value="ğŸ—‘ï¸" onclick="this.parentNode.parentNode.remove();"><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type="button" value="æ–°å»ºå€¼" onclick="this.parentNode.parentNode.querySelector('.dict_values').insertAdjacentHTML('beforeend', '<div><input type=\\'text\\' class=\\'dict_td_input\\' onblur=\\'if (!this.value) this.parentNode.remove();\\'></div>');"></td><td><input type="text" class="dict_key" value="${i}"></td><td class="dict_values">`;
                    for (let j of dictjson.pwr[i]) {
                        inh += `<div><input type="text" class="dict_td_input" value="${j}" onblur="if (!this.value) this.parentNode.remove();"></div>`;
                    }
                    tr.innerHTML = inh + "</td>";
                    dicttb_pwr.appendChild(tr);
                }
                let dicttb_qth = document.getElementById("dicttable_qth");
                for (let i of Object.keys(dictjson.qth)) {
                    let tr = document.createElement("tr");
                    let inh = `<td><input type="button" value="ğŸ—‘ï¸" onclick="this.parentNode.parentNode.remove();"><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type="button" value="æ–°å»ºå€¼" onclick="this.parentNode.parentNode.querySelector('.dict_values').insertAdjacentHTML('beforeend', '<div><input type=\\'text\\' class=\\'dict_td_input\\' onblur=\\'if (!this.value) this.parentNode.remove();\\'></div>');"></td><td><input type="text" class="dict_key" value="${i}"></td><td class="dict_values">`;
                    for (let j of dictjson.qth[i]) {
                        inh += `<div><input type="text" class="dict_td_input" value="${j}" onblur="if (!this.value) this.parentNode.remove();"></div>`;
                    }
                    tr.innerHTML = inh + "</td>";
                    dicttb_qth.appendChild(tr);
                }
            });

        function submit() {
            let tmplsuccess = false;
            let dictsuccess = false;
            // æ•´ç†æäº¤æ¨¡æ¿
            let jsontmpl = new Array();
            for (let ele of document.getElementById("tmpltable").children) {
                let callsign = ele.querySelector(".tmpl_callsign").value;
                let rig = ele.querySelector(".tmpl_rig").value;
                let ant = ele.querySelector(".tmpl_ant").value;
                let pwr = ele.querySelector(".tmpl_pwr").value;
                let qth = ele.querySelector(".tmpl_qth").value;
                if (!callsign || !rig || !ant || !pwr || !qth) continue;
                if (jsontmpl.some(item => item.callsign == callsign && item.rig == rig && item.ant == ant && item.pwr == pwr && item.qth == qth)) continue;
                jsontmpl.push({ "callsign": callsign, "rig": rig, "ant": ant, "pwr": pwr, "qth": qth });
            }
            fetch(`http://${window.location.host}/editdb`, {
                method: "POST",
                headers: {
                    "Content-type": "application/x-www-form-urlencoded",
                },
                body: `type=tmpl&payload=${encodeURIComponent(JSON.stringify(jsontmpl))}`
            }).then((response) => {
                if (response.ok) window.location.reload();
                else document.querySelectorAll(".tmplstat").forEach(e => e.innerText = "æ¨¡æ¿ä¿å­˜å¤±è´¥");
            });
            // æ•´ç†æäº¤å­—å…¸
            let jsondict = { "rig": {}, "ant": {}, "pwr": {}, "qth": {} };
            for (let ele of document.getElementById("dicttable_rig").children) {
                let k = ele.querySelector(".dict_key").value;
                if (!k) continue;
                if (!(jsondict.rig[k])) jsondict.rig[k] = new Array();
                for (let inputs of ele.querySelector(".dict_values").children) {
                    let v = inputs.querySelector(".dict_td_input").value;
                    if (v && !jsondict.rig[k].includes(v)) jsondict.rig[k].push(v);
                }
            }
            for (let ele of document.getElementById("dicttable_ant").children) {
                let k = ele.querySelector(".dict_key").value;
                if (!k) continue;
                if (!(jsondict.ant[k])) jsondict.ant[k] = new Array();
                for (let inputs of ele.querySelector(".dict_values").children) {
                    let v = inputs.querySelector(".dict_td_input").value;
                    if (v && !jsondict.ant[k].includes(v)) jsondict.ant[k].push(v);
                }
            }
            for (let ele of document.getElementById("dicttable_pwr").children) {
                let k = ele.querySelector(".dict_key").value;
                if (!k) continue;
                if (!(jsondict.pwr[k])) jsondict.pwr[k] = new Array();
                for (let inputs of ele.querySelector(".dict_values").children) {
                    let v = inputs.querySelector(".dict_td_input").value;
                    if (v && !jsondict.pwr[k].includes(v)) jsondict.pwr[k].push(v);
                }
            }
            for (let ele of document.getElementById("dicttable_qth").children) {
                let k = ele.querySelector(".dict_key").value;
                if (!k) continue;
                if (!(jsondict.qth[k])) jsondict.qth[k] = new Array();
                for (let inputs of ele.querySelector(".dict_values").children) {
                    let v = inputs.querySelector(".dict_td_input").value;
                    if (v && !jsondict.qth[k].includes(v)) jsondict.qth[k].push(v);
                }
            }
            fetch(`http://${window.location.host}/editdb`, {
                method: "POST",
                headers: {
                    "Content-type": "application/x-www-form-urlencoded",
                },
                body: `type=dict&payload=${encodeURIComponent(JSON.stringify(jsondict))}`
            }).then((response) => {
                if (response.ok) window.location.reload();
                else document.querySelectorAll(".dictstat").forEach(e => e.innerText = " å­—å…¸ä¿å­˜å¤±è´¥");
            });
        }
    </script>
    <style>
        table {
            margin: 0 auto;
            border: 1px solid #000000;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #000000;
            padding: 2px;
        }
    </style>
</head>

<body>
    <h1>ç¼–è¾‘æ•°æ®åº“ - ä¸šä½™æ— çº¿ç”µå°ç½‘ç‚¹åè®°å½•åŠ©æ‰‹</h1>
    <a href="javascript:void(0);" onclick="location.assign(`http:&#47;&#47;${window.location.host}&#47;`)">è¿”å›ä¸»é¡µ</a>
    <div>
        <p>
            <input type="button" onclick="show('edittmpl')" value="ç¼–è¾‘æ¨¡æ¿">
            <input type="button" onclick="show('editrigs')" value="ç¼–è¾‘è®¾å¤‡å­—å…¸">
            <input type="button" onclick="show('editants')" value="ç¼–è¾‘å¤©çº¿å­—å…¸">
            <input type="button" onclick="show('editpwrs')" value="ç¼–è¾‘åŠŸç‡å­—å…¸">
            <input type="button" onclick="show('editqths')" value="ç¼–è¾‘å°å€å­—å…¸">
        </p>
    </div>
    <div>
        <p>
            <input type="button" onclick="submit()" value="ä¿å­˜">
            <span class="tmplstat"></span>
            <span class="dictstat"></span>
        </p>
    </div>
    <hr>
    <div id="edittmpl" class="edit">
        <table>
            <thead>
                <tr>
                    <td>æ“ä½œ</td>
                    <td>å‘¼å·</td>
                    <td>è®¾å¤‡</td>
                    <td>å¤©çº¿</td>
                    <td>åŠŸç‡</td>
                    <td>å°å€</td>
                </tr>
            </thead>
            <tbody id="tmpltable"></tbody>
        </table>
        <input type="button" value="æ–°å¢æ¡ç›®"
            onclick="document.getElementById('tmpltable').insertAdjacentHTML('beforeend', `<td><input type='button' value='ğŸ—‘ï¸' onclick='this.parentNode.parentNode.remove();'><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'></td><td><input type='text' class='tmpl_callsign'></td><td><input type='text' class='tmpl_rig'></td><td><input type='text' class='tmpl_ant'></td><td><input type='text' class='tmpl_pwr'></td><td><input type='text' class='tmpl_qth'></td>`);">
    </div>
    <div id="editrigs" class="edit" hidden>
        <table>
            <thead>
                <tr>
                    <td>æ“ä½œ</td>
                    <td>è®¾å¤‡ç¼©å†™</td>
                    <td>è®¾å¤‡è¡¥å…¨</td>
                </tr>
            </thead>
            <tbody id="dicttable_rig"></tbody>
        </table>
        <input type="button" value="æ–°å¢æ¡ç›®"
            onclick="document.getElementById('dicttable_rig').insertAdjacentHTML('beforeend', `<td><input type='button' value='ğŸ—‘ï¸' onclick='this.parentNode.parentNode.remove();'><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type='button' value='æ–°å»ºå€¼' onclick='this.parentNode.parentNode.querySelector(&quot;.dict_values&quot;).insertAdjacentHTML(&quot;beforeend&quot;, &quot;<div><input type=\\&quot;text\\&quot; class=\\&quot;dict_td_input\\&quot; onblur=\\&quot;if (!this.value) this.parentNode.remove();\\&quot;></div>&quot;);'></td><td><input type='text' class='dict_key'></td><td class='dict_values'></td>`);">
    </div>
    <div id="editants" class="edit" hidden>
        <table>
            <thead>
                <tr>
                    <td>æ“ä½œ</td>
                    <td>å¤©çº¿ç¼©å†™</td>
                    <td>å¤©çº¿è¡¥å…¨</td>
                </tr>
            </thead>
            <tbody id="dicttable_ant"></tbody>
        </table>
        <input type="button" value="æ–°å¢æ¡ç›®"
            onclick="document.getElementById('dicttable_ant').insertAdjacentHTML('beforeend', `<td><input type='button' value='ğŸ—‘ï¸' onclick='this.parentNode.parentNode.remove();'><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type='button' value='æ–°å»ºå€¼' onclick='this.parentNode.parentNode.querySelector(&quot;.dict_values&quot;).insertAdjacentHTML(&quot;beforeend&quot;, &quot;<div><input type=\\&quot;text\\&quot; class=\\&quot;dict_td_input\\&quot; onblur=\\&quot;if (!this.value) this.parentNode.remove();\\&quot;></div>&quot;);'></td><td><input type='text' class='dict_key'></td><td class='dict_values'></td>`);">
    </div>
    <div id="editpwrs" class="edit" hidden>
        <table>
            <thead>
                <tr>
                    <td>æ“ä½œ</td>
                    <td>åŠŸç‡ç¼©å†™</td>
                    <td>åŠŸç‡è¡¥å…¨</td>
                </tr>
            </thead>
            <tbody id="dicttable_pwr"></tbody>
        </table>
        <input type="button" value="æ–°å¢æ¡ç›®"
            onclick="document.getElementById('dicttable_pwr').insertAdjacentHTML('beforeend', `<td><input type='button' value='ğŸ—‘ï¸' onclick='this.parentNode.parentNode.remove();'><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type='button' value='æ–°å»ºå€¼' onclick='this.parentNode.parentNode.querySelector(&quot;.dict_values&quot;).insertAdjacentHTML(&quot;beforeend&quot;, &quot;<div><input type=\\&quot;text\\&quot; class=\\&quot;dict_td_input\\&quot; onblur=\\&quot;if (!this.value) this.parentNode.remove();\\&quot;></div>&quot;);'></td><td><input type='text' class='dict_key'></td><td class='dict_values'></td>`);">
    </div>
    <div id="editqths" class="edit" hidden>
        <table>
            <thead>
                <tr>
                    <td>æ“ä½œ</td>
                    <td>å°å€ç¼©å†™</td>
                    <td>å°å€è¡¥å…¨</td>
                </tr>
            </thead>
            <tbody id="dicttable_qth"></tbody>
        </table>
        <input type="button" value="æ–°å¢æ¡ç›®"
            onclick="document.getElementById('dicttable_qth').insertAdjacentHTML('beforeend', `<td><input type='button' value='ğŸ—‘ï¸' onclick='this.parentNode.parentNode.remove();'><input type='button' value='â¬†ï¸' onclick='if (this.parentNode.parentNode.previousElementSibling) this.parentNode.parentNode.previousElementSibling.before(this.parentNode.parentNode);'><input type='button' value='â¬‡ï¸' onclick='if (this.parentNode.parentNode.nextElementSibling) this.parentNode.parentNode.nextElementSibling.after(this.parentNode.parentNode);'><input type='button' value='æ–°å»ºå€¼' onclick='this.parentNode.parentNode.querySelector(&quot;.dict_values&quot;).insertAdjacentHTML(&quot;beforeend&quot;, &quot;<div><input type=\\&quot;text\\&quot; class=\\&quot;dict_td_input\\&quot; onblur=\\&quot;if (!this.value) this.parentNode.remove();\\&quot;></div>&quot;);'></td><td><input type='text' class='dict_key'></td><td class='dict_values'></td>`);">
    </div>
    <hr>
    <div>
        <p>
            <input type="button" onclick="submit()" value="ä¿å­˜">
            <span class="tmplstat"></span>
            <span class="dictstat"></span>
        </p>
    </div>
</body>

</html>
